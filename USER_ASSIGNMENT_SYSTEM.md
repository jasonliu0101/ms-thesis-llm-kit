# ä½¿ç”¨è€…åˆ†é…ç³»çµ±è¨­å®šæŒ‡å—

## ğŸ“‹ ç³»çµ±æ¶æ§‹

æœ¬ç³»çµ±å¯¦ç¾äº†è‡ªå‹•ä½¿ç”¨è€…åˆ†é…åŠŸèƒ½ï¼Œå°‡è¨ªå•è€…è‡ªå‹•åˆ†é…åˆ°å…©å€‹ä¸åŒçš„å¯¦é©—ç‰ˆæœ¬ï¼š

- **Case A**: `case-a.html` - å¯¦é©—ç‰ˆæœ¬ A
- **Case B**: `case-b.html` - å¯¦é©—ç‰ˆæœ¬ B

## ğŸš€ å·¥ä½œæµç¨‹

### 1. çµ±ä¸€å…¥å£
- æ‰€æœ‰ä½¿ç”¨è€…é¦–å…ˆè¨ªå• `index.html`ï¼ˆä¸»é ï¼‰
- é é¢æœƒè‡ªå‹•å•Ÿå‹•åˆ†é…æµç¨‹

### 2. å¾Œç«¯åˆ†é…é‚è¼¯
- Worker çš„ `/assign` ç«¯é»è™•ç†åˆ†é…è«‹æ±‚
- ä½¿ç”¨åŸºæ–¼æ™‚é–“æˆ³å’Œå®¢æˆ¶ç«¯è³‡è¨Šçš„é›œæ¹Šæ¼”ç®—æ³•
- ç¢ºä¿ç›¸å°å‡å‹»çš„åˆ†é…æ¯”ä¾‹

### 3. è‡ªå‹•è·³è½‰
- åˆ†é…å®Œæˆå¾Œè‡ªå‹•è·³è½‰åˆ°å°æ‡‰çš„å¯¦é©—é é¢
- Case A: `https://jasonliu0101.github.io/ms-thesis-llm-kit/case-a.html`
- Case B: `https://jasonliu0101.github.io/ms-thesis-llm-kit/case-b.html`

## âš™ï¸ æŠ€è¡“å¯¦ç¾

### å‰ç«¯ (index.html)
- ä½¿ç”¨ fetch API èª¿ç”¨å¾Œç«¯åˆ†é…æœå‹™
- åŒ…å«æœ¬åœ°å‚™ç”¨åˆ†é…é‚è¼¯ï¼ˆç¶²è·¯å•é¡Œæ™‚ä½¿ç”¨ï¼‰
- å„ªé›…çš„è¼‰å…¥å‹•ç•«å’ŒéŒ¯èª¤è™•ç†

### å¾Œç«¯ (worker.js)
```javascript
// æ–°å¢çš„è·¯ç”±è™•ç†
if (path === '/assign' && request.method === 'POST') {
  return handleUserAssignment(request, env);
}
```

### åˆ†é…æ¼”ç®—æ³•
```javascript
// åŸºæ–¼å®¢æˆ¶ç«¯è³‡è¨Šå‰µå»ºé›œæ¹Šå€¼
const hashInput = `${timestamp}-${userAgent}-${referrer}`;
let hash = 0;
for (let i = 0; i < hashInput.length; i++) {
  const char = hashInput.charCodeAt(i);
  hash = ((hash << 5) - hash) + char;
  hash = hash & hash;
}

// å¶æ•¸åˆ†é…åˆ° Case Aï¼Œå¥‡æ•¸åˆ†é…åˆ° Case B
const shouldUseCaseA = Math.abs(hash) % 2 === 0;
```

## ğŸ“Š æ—¥èªŒèˆ‡åˆ†æ

### åˆ†é…æ—¥èªŒ
æ¯æ¬¡åˆ†é…éƒ½æœƒè¨˜éŒ„ä»¥ä¸‹è³‡è¨Šï¼š
- æ™‚é–“æˆ³
- åˆ†é…çµæœ (Case A/B)
- å®¢æˆ¶ç«¯è³‡è¨Š (User Agent, Referrer)
- é›œæ¹Šå€¼
- è·³è½‰ URL

### æŸ¥çœ‹æ—¥èªŒ
åœ¨ Cloudflare Dashboard ä¸­çš„ Worker å³æ™‚æ—¥èªŒå¯ä»¥çœ‹åˆ°ï¼š
```
ğŸ“Š åˆ†é…æ—¥èªŒ: {
  "timestamp": "2024-XX-XX...",
  "assignedCase": "Case A",
  "clientInfo": {...},
  "hash": 12345,
  "redirectUrl": "https://..."
}
```

## ğŸ”§ é…ç½®é¸é …

### æ›´æ–° Worker URL
åœ¨ `index.html` ä¸­ä¿®æ”¹ï¼š
```javascript
const workerUrl = 'https://ai-qa-backend.jasonliu01010.workers.dev';
```

### æ›´æ–°è·³è½‰ URL
åœ¨ `worker.js` çš„ `handleUserAssignment` å‡½æ•¸ä¸­ä¿®æ”¹ï¼š
```javascript
const redirectUrl = shouldUseCaseA 
  ? 'https://your-domain.github.io/repo-name/case-a.html'
  : 'https://your-domain.github.io/repo-name/case-b.html';
```

## ğŸŒ éƒ¨ç½²æ­¥é©Ÿ

### 1. éƒ¨ç½² Worker æ›´æ–°
```bash
wrangler deploy --keep-vars
```

### 2. ç¢ºèª GitHub Pages è¨­å®š
- ç¢ºä¿ `index.html` æ˜¯å€‰åº«æ ¹ç›®éŒ„çš„ä¸»é 
- ç¢ºèª `case-a.html` å’Œ `case-b.html` éƒ½å¯æ­£å¸¸è¨ªå•

### 3. æ¸¬è©¦åˆ†é…åŠŸèƒ½
1. è¨ªå•ä¸»é ï¼š`https://jasonliu0101.github.io/ms-thesis-llm-kit/`
2. è§€å¯Ÿæ˜¯å¦æ­£ç¢ºè·³è½‰åˆ° case-a æˆ– case-b
3. æª¢æŸ¥ Worker æ—¥èªŒç¢ºèªåˆ†é…è¨˜éŒ„

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. åˆ†é…æœå‹™ç„¡å›æ‡‰
- æª¢æŸ¥ Worker URL æ˜¯å¦æ­£ç¢º
- ç¢ºèª Worker å·²æ­£ç¢ºéƒ¨ç½²
- æŸ¥çœ‹ Worker å³æ™‚æ—¥èªŒä¸­çš„éŒ¯èª¤

#### 2. è·³è½‰å¤±æ•—
- ç¢ºèª case-a.html å’Œ case-b.html æª”æ¡ˆå­˜åœ¨
- æª¢æŸ¥ GitHub Pages æ˜¯å¦æ­£å¸¸é‹ä½œ
- é©—è­‰è·³è½‰ URL æ˜¯å¦æ­£ç¢º

#### 3. æœ¬åœ°å‚™ç”¨æ–¹æ¡ˆå•Ÿç”¨
- é€™æ˜¯æ­£å¸¸è¡Œç‚ºï¼Œåœ¨ç¶²è·¯å•é¡Œæ™‚æœƒè‡ªå‹•å•Ÿç”¨
- æœ¬åœ°æ–¹æ¡ˆä¹Ÿæœƒé€²è¡Œéš¨æ©Ÿåˆ†é…

### é™¤éŒ¯æ–¹æ³•
1. é–‹å•Ÿç€è¦½å™¨é–‹ç™¼è€…å·¥å…·æŸ¥çœ‹ Console æ—¥èªŒ
2. æª¢æŸ¥ Network é¸é …å¡ä¸­çš„ API è«‹æ±‚
3. åœ¨ Cloudflare Dashboard æŸ¥çœ‹ Worker å³æ™‚æ—¥èªŒ

## ğŸ“ˆ æ•ˆæœé©—è­‰

### åˆ†é…æ¯”ä¾‹æª¢æŸ¥
å®šæœŸæª¢æŸ¥ Worker æ—¥èªŒä»¥ç¢ºèªï¼š
- Case A å’Œ Case B çš„åˆ†é…æ¯”ä¾‹å¤§è‡´ç›¸ç­‰
- æ²’æœ‰æ˜é¡¯çš„åˆ†é…åå·®

### ä½¿ç”¨è€…é«”é©—
- åˆ†é…æµç¨‹æ‡‰è©²åœ¨ 1-2 ç§’å…§å®Œæˆ
- è¼‰å…¥å‹•ç•«æ‡‰è©²æä¾›è‰¯å¥½çš„è¦–è¦ºå›é¥‹
- éŒ¯èª¤æƒ…æ³ä¸‹æ‡‰è©²æœ‰é©ç•¶çš„æç¤º

---

**æ³¨æ„äº‹é …**ï¼š
- åˆ†é…æ˜¯åŸºæ–¼é›œæ¹Šæ¼”ç®—æ³•ï¼Œä¸æ˜¯å®Œå…¨éš¨æ©Ÿ
- ç›¸åŒçš„å®¢æˆ¶ç«¯åœ¨çŸ­æ™‚é–“å…§å¯èƒ½æœƒè¢«åˆ†é…åˆ°ç›¸åŒçš„ç‰ˆæœ¬
- å¦‚éœ€å®Œå…¨éš¨æ©Ÿåˆ†é…ï¼Œå¯ä»¥è€ƒæ…®ä½¿ç”¨ Cloudflare KV æˆ– Durable Objects ä¾†å¯¦ç¾æŒä¹…è¨ˆæ•¸å™¨
